{% extends "base.html" %}

{% block title %}Relatório de Guerra do Clã{% endblock %}

{% block content %}
<header>
    <h1>Histórico de Participação em Guerras</h1>
    <p>Dados oficiais da Supercell, atualizados em: {{ report_date }}</p>
    <div class="metrics-info">
        <strong>Métricas do Player Status:</strong><br>
        - <strong>Campeão:</strong> Usou 16 ou mais decks em ambas as duas últimas guerras.<br>
        - <strong>Ok:</strong> Performance consistente, com 12 a 15 decks usados.<br>
        - <strong>Verificar:</strong> Usou 11 ou menos decks em alguma das duas últimas guerras, ou é um jogador sem histórico.<br>
        - O símbolo <strong>'-'</strong> indica que o jogador não estava no clã naquela guerra específica.
    </div>
    <form action="/update" method="get">
        <button type="submit" class="update-button">Atualizar Dados</button>
    </form>
</header>

<div class="table-container">
    {% if players %}
    <table id="war-report-table" class="display">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Player Status</th>
                <th>Última Guerra</th>
                <th>Guerra -2</th>
                <th>Guerra -3</th>
                <th>Guerra -4</th>
                <th>Guerra -5</th>
            </tr>
        </thead>
        <tbody>
            {% for player in players %}
            <tr>
                <td>{{ player['Nome'] }}</td>
                <td>
                    <span class="status status-{{ player['Player Status'] | lower }}">
                        {{ player['Player Status'] }}
                    </span>
                </td>
                <td>{{ player['Última Guerra'] }}</td>
                <td>{{ player['Guerra -2'] }}</td>
                <td>{{ player['Guerra -3'] }}</td>
                <td>{{ player['Guerra -4'] }}</td>
                <td>{{ player['Guerra -5'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Nenhum dado de jogador encontrado. Verifique se o Clan Tag está correto e se há uma guerra ativa.</p>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% if players %}
<script>
$(document).ready(function() {
    $('#war-report-table').DataTable({
        dom: 'Bfrtip', // Adiciona os botões ao DOM
        buttons: [
            {
                extend: 'pdfHtml5',
                text: 'Exportar para PDF',
                title: 'Relatorio de Guerra - {{ report_date }}',
                orientation: 'landscape',
                pageSize: 'A4'
            }
        ],
        paging: false,
        info: false,
        language: {
            search: "Buscar:",
            zeroRecords: "Nenhum resultado encontrado"
        }
    });
});
</script>
{% endif %}
{% endblock %}
